---
title: "flowPloidy: Flow Cytometry Histograms"
author: "Tyler Smith"
date: "`r Sys.Date()`"
output: 
    rmarkdown::html_vignette:
        fig_width: 6
        fig_height: 4
    pdf_document:
        fig_width: 6
        fig_height: 4
        fig_caption: false
        pandoc_args: ["--variable=fontfamily:tgschola"]
vignette: >
  %\VignetteIndexEntry{flowPloidy: FCM Histograms}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: flowPloidy.bibtex
---

Flow cytometry (FCM) is based on a simple concept. Cell nuclei are stained
with DNA-binding fluorochromes, and the amount of DNA present is determined
by measuring the fluorescence emitted when the nuclei are excited with
light of a particular wavelength. Greater fluorescence means more DNA in
the nucleus. That is, a diploid nucleus should produce half the
fluorescence of a tetraploid nucleus, and a hexaploid nucleus should
produce three times more fluorescence than the diploid.

Applying this concept is complicated by several factors:

* nuclear DNA content varies over the cell cycle
* secondary metabolites may interfere with fluorochrome staining
* tissue preparations are usually contaminated with non-nuclear cellular
  components, damaged nuclei, and other debris that fluoresce to greater or
  lesser extent
* the accuracy of flow cytometers is limited, and values tend to shift or
  drift over the course of a run
      
We can illustrate these challenges by comparing an ideal FCM DNA histogram
with actual experimental data. 

```{r ideal histogram, echo = FALSE}
plot(x = 1, type = 'n', xlim = c(0, 256), ylim = c(0, 500),
     ylab = "Nuclei", xlab = "Fluorescence", main = "Ideal Histogram")
abline(h = 0)
lines(x = c(80, 80), y = c(0, 325))
lines(x = c(160, 160), y = c(0, 150))
tmpfun <- function(x) 100 * exp(-x/80)
curve(tmpfun, 80, 160, add = TRUE)
text(x = 80, y = 325, "G1 Peak", pos = 3)
text(x = 160, y = 150, "G2 Peak", pos = 3)
text(x = 120, y = 30, "S Phase", pos = 3)
```

In the ideal case, we have two clear, accurate "peaks", G1 and G2. The G1
("gap 1") peak represents cells in their 'normal' state. That is, they have
the usual diploid DNA complement. The G2 ("gap 2") peak represents cells
that have duplicated their DNA, but haven't yet undergone mitosis.
Consequently, they have twice the diploid DNA complement. In between the
two peaks is the S ("synthesis") region. This area of the plot represents
cells that are in the process of duplicating their DNA, in preparation for
mitosis.

If our histogram were this clean, we could easily determine the DNA content
of our sample by comparing it to a known standard (see below). In practice,
you'll never see a histogram that looks like this. A more realistic example
follows:

```{r real histogram, echo = FALSE}
set.seed(1234)
plot(x = 1, type = 'n', xlim = c(0, 256), ylim = c(0, 500),
     ylab = "Nuclei", xlab = "Fluorescence", main = "Empirical Histogram")
abline(h = 0)

vals <- rep(0, 256)
vals <- jitter(3500 * dnorm(0:256, mean = 80, sd = 80 * 0.05), amount = 20)
vals <- vals + jitter(200 * exp ((0:-256)/60), amount = 5)
vals <- vals +
  jitter(2500 * dnorm(0:256, mean = 160, sd = 160 * 0.05), amount = 20)
vals[80:160] <- vals[80:160] + jitter(100 * exp((-80:-160)/80),
                                      amount = 5)
vals[vals < 0] <- 0
points(vals, type = 'l')

text(x = 80, y = 450, "G1 Peak", pos = 3)
text(x = 160, y = 200, "G2 Peak", pos = 3)
text(x = 120, y = 100, "S Phase", pos = 3)
text(x = 40, y = 170, "Debris", pos = 3)
text(x = 240, y = 40, "Aggregates", pos = 3)
```

We can still see the G1 and G2 peaks, but they aren't exact values. Instead
we see that the fluorescence values for each peak are distributed around a
mean value. Similarly, the S phase is not a clean polygon. The jagged edges
of the region are due in part to instrument error: we can't capture DNA
content perfectly. In addition, some of that noise is "real". That is, the
cells in our tissue sample are not proceeding through the cell cycle in a
perfectly regular manner. Even if we could measure the DNA without error,
the S-phase region wouldn't necessarily be a perfectly smooth region in the
histogram.

In addition to the G1, G2 and S phase regions from our ideal histogram,
real histograms also contain debris. This is a mixture of cellular debris,
damaged nuclei, and other contaminants. The dyes we use bind best to DNA,
so most of the debris, which contains relatively little DNA, is found on
the left side of the histogram. We may also see aggregates at the right
side of the plot. These are nuclei that have stuck together in the flow
cytometer, and so may be appear to be higher-ploidy nuclei.
